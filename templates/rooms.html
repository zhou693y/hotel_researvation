<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ¿ç®¡ç† - é…’åº—å®¢æˆ¿é¢„è®¢ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ é…’åº—å®¢æˆ¿é¢„è®¢ç³»ç»Ÿ</h1>
            <nav>
                <a href="/">é¦–é¡µ</a>
                <a href="/rooms" class="active">å®¢æˆ¿ç®¡ç†</a>
                <a href="/customers">å®¢æˆ·ç®¡ç†</a>
                <a href="/bookings">é¢„è®¢ç®¡ç†</a>
            </nav>
        </header>

        <main>
            <div class="page-header">
                <h2>å®¢æˆ¿ç®¡ç†</h2>
                <button class="btn btn-primary" onclick="showAddModal()">+ æ·»åŠ å®¢æˆ¿</button>
            </div>

            <div class="table-container">
                <table id="roomsTable">
                    <thead>
                        <tr>
                            <th>æˆ¿é—´å·</th>
                            <th>æˆ¿å‹</th>
                            <th>ä»·æ ¼</th>
                            <th>çŠ¶æ€</th>
                            <th>æ¥¼å±‚</th>
                            <th>æè¿°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="roomsTableBody">
                        <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘å®¢æˆ¿æ¨¡æ€æ¡† -->
    <div id="roomModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">æ·»åŠ å®¢æˆ¿</h3>
            <form id="roomForm">
                <input type="hidden" id="roomId">
                <div class="form-group">
                    <label>æˆ¿é—´å·:</label>
                    <input type="text" id="roomNumber" required>
                </div>
                <div class="form-group">
                    <label>æˆ¿å‹:</label>
                    <select id="roomType" required>
                        <option value="å•äººé—´">å•äººé—´</option>
                        <option value="åŒäººé—´">åŒäººé—´</option>
                        <option value="å¥—æˆ¿">å¥—æˆ¿</option>
                        <option value="è±ªåå¥—æˆ¿">è±ªåå¥—æˆ¿</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ä»·æ ¼:</label>
                    <input type="number" id="price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>çŠ¶æ€:</label>
                    <select id="status">
                        <option value="ç©ºé—²">ç©ºé—²</option>
                        <option value="å·²é¢„è®¢">å·²é¢„è®¢</option>
                        <option value="å·²å…¥ä½">å·²å…¥ä½</option>
                        <option value="ç»´æŠ¤ä¸­">ç»´æŠ¤ä¸­</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ¥¼å±‚:</label>
                    <input type="number" id="floorNumber" required>
                </div>
                <div class="form-group">
                    <label>æè¿°:</label>
                    <textarea id="description" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                    <button type="button" class="btn" onclick="closeModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        let isEditMode = false;

        // åŠ è½½å®¢æˆ¿åˆ—è¡¨
        function loadRooms() {
            fetch('/api/rooms')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const tbody = document.getElementById('roomsTableBody');
                        tbody.innerHTML = '';
                        data.data.forEach(room => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td>${room.room_number}</td>
                                <td>${room.room_type}</td>
                                <td>Â¥${room.price}</td>
                                <td><span class="status-badge status-${room.status}">${room.status}</span></td>
                                <td>${room.floor_number}æ¥¼</td>
                                <td>${room.description || '-'}</td>
                                <td>
                                    <button class="btn-small" onclick="editRoom(${room.room_id})">ç¼–è¾‘</button>
                                    <button class="btn-small btn-danger" onclick="deleteRoom(${room.room_id})">åˆ é™¤</button>
                                </td>
                            `;
                            tbody.appendChild(tr);
                        });
                    }
                });
        }

        // æ˜¾ç¤ºæ·»åŠ æ¨¡æ€æ¡†
        function showAddModal() {
            isEditMode = false;
            document.getElementById('modalTitle').textContent = 'æ·»åŠ å®¢æˆ¿';
            document.getElementById('roomForm').reset();
            document.getElementById('roomId').value = '';
            document.getElementById('status').closest('.form-group').style.display = 'none';
            document.getElementById('roomModal').style.display = 'block';
        }

        // ç¼–è¾‘å®¢æˆ¿
        function editRoom(roomId) {
            isEditMode = true;
            fetch('/api/rooms')
                .then(response => response.json())
                .then(data => {
                    const room = data.data.find(r => r.room_id === roomId);
                    if (room) {
                        document.getElementById('modalTitle').textContent = 'ç¼–è¾‘å®¢æˆ¿';
                        document.getElementById('roomId').value = room.room_id;
                        document.getElementById('roomNumber').value = room.room_number;
                        document.getElementById('roomType').value = room.room_type;
                        document.getElementById('price').value = room.price;
                        document.getElementById('status').value = room.status;
                        document.getElementById('floorNumber').value = room.floor_number;
                        document.getElementById('description').value = room.description || '';
                        document.getElementById('status').closest('.form-group').style.display = 'block';
                        document.getElementById('roomModal').style.display = 'block';
                    }
                });
        }

        // åˆ é™¤å®¢æˆ¿
        function deleteRoom(roomId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå®¢æˆ¿å—ï¼Ÿ')) {
                fetch(`/api/rooms/${roomId}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        if (data.success) loadRooms();
                    });
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('roomModal').style.display = 'none';
        }

        // è¡¨å•æäº¤
        document.getElementById('roomForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const roomData = {
                room_number: document.getElementById('roomNumber').value,
                room_type: document.getElementById('roomType').value,
                price: parseFloat(document.getElementById('price').value),
                floor_number: parseInt(document.getElementById('floorNumber').value),
                description: document.getElementById('description').value
            };

            if (isEditMode) {
                roomData.status = document.getElementById('status').value;
                const roomId = document.getElementById('roomId').value;
                fetch(`/api/rooms/${roomId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(roomData)
                })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        if (data.success) {
                            closeModal();
                            loadRooms();
                        }
                    });
            } else {
                fetch('/api/rooms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(roomData)
                })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        if (data.success) {
                            closeModal();
                            loadRooms();
                        }
                    });
            }
        });

        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        loadRooms();
    </script>
</body>

</html>